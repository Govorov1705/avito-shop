# avito-shop

## Запуск проекта

Файлы с переменными окружения находятся в репозитории для простоты в демонстрационных целях.

Запуск:

```shell
$ docker compose up
```

## Запуск тестов

Для запуска тестов необходимо сначала запустить сервисы:

```shell
$ docker compose up
```

Потом найти _id_ контейнера с API. Для вывода списка контейнеров:

```shell
$ docker ps
```

После этого нужно войти в контейнер, указав его _id_:

```shell
$ docker exec -it <id контейнера> /bin/bash
```

Далее можно запустить тесты:

```shell
$ pytest -s -v
```

### Проверка % покрытия

Для проверки % покрытия тестами необходимо сначала запустить сервисы:

```shell
$ docker compose up
```

Потом найти _id_ контейнера с API. Для вывода списка контейнеров:

```shell
$ docker ps
```

После этого нужно войти в контейнер, указав его _id_:

```shell
$ docker exec -it <id контейнера> /bin/bash
```

Затем нужно запустить тесты с помощью _Coverage_:

```shell
$ coverage run -m pytest
```

Теперь можно проверить % покрытия тестами:

```shell
$ coverage report
```

## Проблемы

**Проблема:** FastAPI не позволяет адекватным образом переписать HTTP-ответ, который будет возвращен на запрос с некорректными данными - фреймворк возвращает 422 и использует свою схему.
**Решение:** было принято решение не строить "костыли", а оставить все так, как хочет фреймворк.

**Проблема:** FastAPI включает в раздел "Schemas" в документации все Pydantic модели, используемые в проекте, в том числе те, которых по требуемому API быть не должно, но они были использованы в наследовании моделей Pydantic для уменьшения дублирования кода.
**Решение:** я решил оставить это так, как есть, поскольку поля в этих схемах не чувствительные, плюс, в противном случае, пришлось бы сильно дублировать код.
